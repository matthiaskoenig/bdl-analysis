<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{BDL ANOVA}
-->
# Dimension reduction via ANOVA
Dimension reduction of the BDL data set is performed by filtering out all factors not changing significantly during the time course. For every single factor an ANOVA is calculated with subsequent filtering based on adjusted p-value (multiple testing correction by testing on all factors). The ANOVA tests if any of the time points has a significantly different mean.

Definition of paths
```{r path}
baseLoc <- system.file(package="BDLanalysis")
extPath <- file.path(baseLoc, "extdata")
resultsPath <- "/home/mkoenig/git/bdl-analysis/results"
```

## Read BDL data
First the BDL data, BDL sample definition and the fluidigm probe definitions are loaded
```{r BDLdata, eval=TRUE}
library('reshape')
library("calibrate")
library('BDLanalysis')
data(BDLdata)
data(BDLsamples)
data(BDLprobes)
```

The BDLdata set of all timecourses for the factors is reshaped into matrix form for the ANOVA calculation
```{r BDLmatrix}
BDLmatrices <- bdl_matrix_data(BDLdata, BDLsamples)
print(BDLmatrices[[1]])
```

## Perform ANOVA
Now the ANOVA is calculated for all factors and data.frame of p.values returned
```{r ANOVA}
df.anova <- all_factor_anova()  # calculate ANOVA
df.anova$sig <- sapply(df.anova$p.value, significant_code)  # add significant codes
```


## Adjust p-values for multiple testing
Using the p.adjust function which given a set of p-values, returns p-values adjusted using one of several methods. The Bonferroni, Holm, Hochberg, Hommel are designed to give strong control of the family-wise error rate. There seems no reason to use the unmodified Bonferroni correction because it is dominated by Holm's method, which is also valid under arbitrary assumptions.

The correction is performed using Holm  
(Holm, S. (1979). A simple sequentially rejective multiple test procedure. Scandinavian Journal of Statistics 6, 65-70.)
```{r}
df.anova$p.holm <- p.adjust(df.anova$p.value, method ="holm" , n = length(df.anova$p.value))
df.anova$sig.holm <- sapply(df.anova$p.holm, significant_code) 

# order the results py the adjusted p-values
df.anova.ordered <- df.anova[with(df.anova, order(p.holm)), ]
df.anova.ordered
```
Save the results
``` {r}
write.table(df.anova.ordered, file=file.path(resultsPath, 'BDLanova.csv'), sep="\t", quote=FALSE)
BDLanova <- df.anova
save(df.anova, file=file.path(resultsPath, "BDLanova.Rdata"))
```