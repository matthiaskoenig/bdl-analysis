<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{BDL raw data processing}
-->

# BDL Analysis

This script contains the complete statistical analysis for the publication
Pathobiochemical signatures of cholestatic liver disease in bile duct ligated
mice (BMC Systems Biology).

The goal of this work is to analyze two different collections of archived tweets from the ISMB conferences from 2012 and 2014, and compare and contrast them. The collections of tweets are from Neil Saunders ([his initial analysis](http://nsaunders.wordpress.com/2012/08/16/twitter-coverage-of-the-ismb-2012-meeting-some-statistics/) and [data](https://github.com/neilfws/Twitter/tree/master/ismb/data)) and Stephen Turner ([initial analysis](http://gettinggeneticsdone.blogspot.com/2013/05/automated-analysis-tweets-bioinformatics-twitterchive.html) and [data](https://github.com/stephenturner/twitterchive)).

Before we start to use this data, we will do some munging on it so that both data-sets are comparable and we can apply the same functions to them for comparison.

```{r datamunging}
baseLoc <- system.file(package="BDLanalysis")
extPath <- file.path(baseLoc, "extdata")
resultsPath <- "/home/mkoenig/git/bdl-analysis/results"
```

## Read BDL data
The BDL data, BDL sample definition and the Fluidigm probe definitions are loaded via
```{r BDLdata, eval=TRUE}
library("calibrate")
library('BDLanalysis')
data(BDLdata)
data(BDLsamples)
data(BDLprobes)
```

Calculation of mean timecourse for factors averaged over the 5 repeats.
```{r BDLmean}
BDLmean <- bdl_mean_data(BDLdata, BDLsamples)
BDLmean.time <- as.numeric(levels(as.factor(BDLsamples$time)))
```

Create overview plots for all individual factors. These are stored in the
resultsPath folder.
```{r factorPlots, eval=FALSE}
# Single factor visualization
plot_single_factor(name=colnames(BDLdata)[2])

# Creates plots of all factors in BDLdata
plot_all_factors(path=resultsPath)
```


## Actb controls
Actb was measured on all Fluidigm chips and serves as quality control of the measurement/correlation analysis. The pairwise correlation between all Actb measurements should result in high correlation values
```{r CheckActB}
# Actb control figure
options <- list(width=1600, height=600, res=200)
png(filename=file.path(resultsPath, "Actb_control.png"), width=1600, height=600, res=200)
par(mfrow=c(1,3))
plot_cor_pair("Actb", "Actb.x", single_plots=FALSE)
plot_cor_pair("Actb", "Actb.y", single_plots=FALSE)
plot_cor_pair("Actb.x", "Actb.y", single_plots=FALSE)
par(mfrow=c(1,1))
dev.off()

# calculate the correlations
plot_single("Actb")
plot_single("Actb.x")
plot_single("Actb.y")
plot_cor_pair("Actb", "Actb.x", single_plots=FALSE)
plot_cor_pair("Actb", "Actb.y", single_plots=FALSE)
plot_cor_pair("Actb.x", "Actb.y", single_plots=FALSE)

# calculate Spearman and Pearson correlation coefficients on mean and individual
# data
actb.spearman <- cor(data.frame(Actb=BDLdata$Actb, 
                                Actb.x=BDLdata$Actb.x, 
                                Actb.y=BDLdata$Actb.y), method="spearman")

actb.spearman.mean <- cor(data.frame(Actb=BDLmean$Actb, 
                                     Actb.x=BDLmean$Actb.x, 
                                     Actb.y=BDLmean$Actb.y), method="spearman")

actb.pearson <- cor(data.frame(Actb=BDLdata$Actb, 
                               Actb.x=BDLdata$Actb.x, 
                               Actb.y=BDLdata$Actb.y), method="pearson")

actb.pearson.mean <- cor(data.frame(Actb=BDLmean$Actb, 
                                    Actb.x=BDLmean$Actb.x, 
                                    Actb.y=BDLmean$Actb.y), method="pearson")
print(actb.spearman)
print(actb.spearman.mean)
print(actb.pearson)
print(actb.pearson.mean)
```

For a given set of factors the data heatmap provides an overview over the
existing dataset.

```{r dataHeatmap}
#---------------------------------------------
# All data heatmap
#---------------------------------------------
# TODO
```



